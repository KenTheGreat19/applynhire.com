<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Apply N Hire</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="light-theme">
    <header class="site-header">
        <div class="container header-row header-content">
            <div class="brand">
                <a class="site-logo" href="../index.html">
                    <img class="site-logo-img" src="../assets/vendor/images/logo.png" onerror="this.onerror=null;this.src='../assets/vendor/images/logo.svg'" alt="APPLY N HIRE">
                    <span class="site-title">APPLY N HIRE</span>
                </a>
                <p class="tagline">Apply Job and Hire Talent for Free!</p>
            </div>
            <div class="header-actions right-nav">
                <div class="language-selector" id="languageSelector">
                    <button class="lang-btn" id="langBtn" aria-expanded="false" aria-haspopup="true" aria-controls="langDropdown">
                        <span class="flag-icon" aria-hidden="true">ðŸ‡¬ðŸ‡§</span>
                    </button>
                    <div class="lang-dropdown" id="langDropdown" role="menu" aria-hidden="true">
                        <button class="lang-option" data-lang="en" role="menuitem"><span class="flag-icon">ðŸ‡¬ðŸ‡§</span><span>English</span></button>
                        <button class="lang-option" data-lang="es" role="menuitem"><span class="flag-icon">ðŸ‡ªðŸ‡¸</span><span>EspaÃ±ol</span></button>
                        <button class="lang-option" data-lang="fr" role="menuitem"><span class="flag-icon">ðŸ‡«ðŸ‡·</span><span>FranÃ§ais</span></button>
                        <button class="lang-option" data-lang="de" role="menuitem"><span class="flag-icon">ðŸ‡©ðŸ‡ª</span><span>Deutsch</span></button>
                    </div>
                </div>
                <button class="theme-toggle" id="themeToggle" title="Toggle theme" aria-pressed="false">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>
                <a href="sign-in-applicant.html" class="btn-outline btn-applicant">Sign In</a>
                <a href="sign-in-employer.html" class="btn-primary btn-employer">For Employers</a>
            </div>
        </div>
    </header>

    <main class="auth-page">
        <div class="auth-card">
            <div class="auth-avatar"><i class="fas fa-user-plus"></i></div>
            <h2>Create an Account</h2>
            <p class="muted">Choose your account type to get started</p>

            <div class="account-type" style="display: flex; gap: 12px; margin: 2rem 0;">
                <button class="btn btn-outline" style="flex: 1;" onclick="showRoleForm('applicant')">
                    <i class="fas fa-user"></i> I'm looking for jobs
                </button>
                <button class="btn btn-primary" style="flex: 1;" onclick="showRoleForm('employer')">
                    <i class="fas fa-briefcase"></i> I'm hiring
                </button>
            </div>

            <div id="applicantForm" style="display: none;">
                <h3 style="margin-bottom: 1rem;">Applicant Sign Up</h3>
                <form class="auth-form" id="applicantSignUpForm">
                    <div class="form-group">
                        <label for="applicant-name">Full Name</label>
                        <input type="text" id="applicant-name" name="name" placeholder="John Doe" required>
                    </div>
                    <div class="form-group">
                        <label for="applicant-email">Email</label>
                        <input type="email" id="applicant-email" name="email" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="applicant-password">Password</label>
                        <input type="password" id="applicant-password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="6">
                    </div>
                    <div id="applicantError" class="error-message" style="display: none; color: #ef4444; margin-bottom: 1rem;"></div>
                    <button type="submit" class="btn-auth-success">Create Applicant Account</button>
                </form>
            </div>

            <div id="employerForm" style="display: none;">
                <h3 style="margin-bottom: 1rem;">Employer Sign Up</h3>
                <form class="auth-form" id="employerSignUpForm">
                    <div class="form-group">
                        <label for="employer-name">Company Name</label>
                        <input type="text" id="employer-name" name="name" placeholder="Acme Corporation" required>
                    </div>
                    <div class="form-group">
                        <label for="employer-email">Company Email</label>
                        <input type="email" id="employer-email" name="email" placeholder="hr@company.com" required>
                    </div>
                    <div class="form-group">
                        <label for="employer-password">Password</label>
                        <input type="password" id="employer-password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="6">
                    </div>
                    <div id="employerError" class="error-message" style="display: none; color: #ef4444; margin-bottom: 1rem;"></div>
                    <button type="submit" class="btn-auth-primary">Create Employer Account</button>
                </form>
            </div>

            <div class="auth-legal">
                <p>By creating an account, you agree to our <a href="terms.html">Terms</a> and <a href="privacy.html">Privacy policy</a>.</p>
            </div>
            <div class="auth-footer">
                <p>Already have an account? <a href="sign-in-applicant.html">Sign in</a></p>
            </div>
        </div>
    </main>

    <script type="module" src="../js/header.js"></script>
    <script>
        function showRoleForm(role) {
            document.getElementById('applicantForm').style.display = role === 'applicant' ? 'block' : 'none';
            document.getElementById('employerForm').style.display = role === 'employer' ? 'block' : 'none';
        }

        document.getElementById('applicantSignUpForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const name = form.name.value;
            const email = form.email.value;
            const password = form.password.value;
            const errorMessage = document.getElementById('applicantError');

            try {
                const response = await fetch('http://127.0.0.1:8000/api/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password, role: 'applicant' })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Sign up failed');
                }

                // Auto sign in
                const signInResponse = await fetch('http://127.0.0.1:8000/api/signin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const signInData = await signInResponse.json();
                localStorage.setItem('applynhireSession', JSON.stringify({
                    token: signInData.access_token,
                    user: signInData.user
                }));

                window.location.href = '../index.html';
            } catch (error) {
                errorMessage.textContent = error.message;
                errorMessage.style.display = 'block';
            }
        });

        document.getElementById('employerSignUpForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const name = form.name.value;
            const email = form.email.value;
            const password = form.password.value;
            const errorMessage = document.getElementById('employerError');

            try {
                const response = await fetch('http://127.0.0.1:8000/api/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password, role: 'employer' })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Sign up failed');
                }

                // Auto sign in
                const signInResponse = await fetch('http://127.0.0.1:8000/api/signin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const signInData = await signInResponse.json();
                localStorage.setItem('applynhireSession', JSON.stringify({
                    token: signInData.access_token,
                    user: signInData.user
                }));

                window.location.href = '../index.html';
            } catch (error) {
                errorMessage.textContent = error.message;
                errorMessage.style.display = 'block';
            }
        });
    </script>
</body>
</html>
